<!DOCTYPE html>
<meta charset="utf-8">

<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="A layout example that shows off a responsive product landing page.">

<title>taskcode</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/pure/0.6.0/pure-min.css">
<!--[if lte IE 8]>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/pure/0.6.0/grids-responsive-old-ie.css">
<![endif]-->
<!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/pure/0.6.0/grids-responsive.css">
<!--<![endif]-->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/fontawesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="css/taskcode.css">


<link href='https://fonts.googleapis.com/css?family=Roboto:500,300' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Quantico:700' rel='stylesheet' type='text/css'>    
<script src="https://d3js.org/d3.v3.min.js"></script>

</head>

<style>

.line {
  fill: none;
  stroke: steelblue;
  stroke-width: 1.5px;
}

</style>
<body>
<div class="splash-container">
    <div class="splash">
        <h1 class="splash-head">TASKCODE</h1>
        <p class="splash-subhead">
          Predicting construction worker tasks from GPS data
        </p>
    </div>
</div>

<div class="content-wrapper">
    <div class="content">
        <h2 class="content-head is-center">Automatic Task Suggestion</h2>

        <div class="pure-g">
            <div class="l-box-lrg pure-u-1 pure-u-md-3-5">
	      <div id="vis-1"></div>
            </div>
	    <div class="l-box-lrg pure-u-1 pure-u-md-2-5">
	      <div id="vis-3" class="is-center" style="max-width:250px;margin:auto"></div>
	      <div id="vis-4" class="is-center" style="max-width:250px;margin:auto"></div>
            </div>
        </div>

	<p class="is-center">
	  After a task is complete, we can determine a short list of which kind of task it might have been. Task entry with one just one tap.
	</p>
    </div>

    <div class="separator">.</div>

    <div class="content l-box-lrg pure-g">
        <div class="l-box-lrg is-center pure-u-1 pure-u-md-1-2 pure-u-lg-3-5">
            <img class="pure-img-responsive" alt="worker" width="600" src="img/big_construction_site.jpg">
        </div>
        <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-2-5">

            <h2 class="content-head">Value of Labor</h2>

            <p>
	      Every site requires a complex system of labor tasks to finish the job. Keeping track of each can improve lead to better cost estimation and improve the efficiency of construction.
            </p>
        </div>
    </div>

    <div class="separator">.</div>

    <div class="content">
        <h2 class="content-head is-center">GPS Technology</h2>
        <div class="pure-g">
	    <div class="l-box-lrg pure-u-1 pure-u-md-1-2">
              <img class="pure-img-responsive" alt="GPS Technology" width="600" src="img/big_construction_site.jpg">
            </div>
            <div class="l-box-lrg pure-u-1 pure-u-md-1-2">
	      <div id="vis-2"></div>
            </div>
	</div>
	<p class="is-center"> 
	  Broadband GPS gives an accurate location every second to give the system enough information to figure out the work in progress.
	</p>
    </div>

    <div class="separator">.</div>

    <div class="content">
      <h2 class="content-head is-center">Accurate Predictions</h2>
      <p class="is-center">
	Will get filled in with accuracy ASAP!
      </p>
    </div>

    <div class="separator">.</div>

    <div class="content">
      <h2 class="content-head is-center">Approach</h2>
      <p class="is-center">
	A few minutes of GPS data tells a lot about what kind of work is getting done. 
      </p>
      <div class="pure-g">
	<div class="pure-u-1 pure-u-md-1-2">
	  <h4 class="is-center">Information</h4>
	  <ul>
	    <li> Time spent in each corner of a room </li>
	    <li> Speed of movement in one direction or back and forth </li>
	    <li> What was done nearby before starting </li>
	  </ul>
	</div>
	<div class="pure-u-1 pure-u-md-1-2">
	  <h4 class="is-center">Understanding</h4>
	  <ul>
	    <li> GPS data extracted into those quantities</li>
	    <li> Machine learning algorithm discovers patterns</li>
	    <li> Provides predictions for each task</li>
	  </ul>
	</div>
	<div class="pure-u-1 pure-u-md-1-3">

	</div>
      </div>
    </div>

    <div class="separator">.</div>

    <div class="content l-box-lrg pure-g">
        <div class="l-box-lrg is-center pure-u-1 pure-u-md-1-2 pure-u-lg-3-5">
            <img class="pure-img-responsive" alt="File Icons" width="600" src="img/rooms.png">
        </div>
        <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-2-5">

            <h2 class="content-head">Complex Understanding</h2>

            <p class="vert-center">
	      These results were possible with about ten different tasks and dozens of different individual working locations.
            </p>
        </div>
    </div>

    <div class="separator">.</div>

    <div class="content l-box-lrg pure-g">
        <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-2-5">

            <h2 class="content-head">Robust System</h2>

            <p class="vert-center">
	      Even significant gaps in data recording don't compromise the results of the system.
            </p>
        </div>
        <div class="l-box-lrg is-center pure-u-1 pure-u-md-1-2 pure-u-lg-3-5 vert-center">
            <img class="pure-img-responsive" alt="File Icons" width="600" src="img/missingness.png">
        </div>

    </div>
</div>
<script>

function animatedGPS(fname, divid) {
    var width = 600;
    var height = 300;

    var x = d3.scale.linear()
        .range([0, width]);

    var y = d3.scale.linear()
        .range([height, 0]);

    var line = d3.svg.line()
        .x(function(d) { return x(d.x); })
        .y(function(d) { return y(d.y); });

    var svg = d3.select(divid)
      .append("div")
        .classed("svg-container", true) // container class for responsiveness
      .append("svg")
        //responsive SVG needs these 2 attributes and no width and height attr
        .attr("preserveAspectRatio", "xMinYMin meet")
        .attr("viewBox", "0 0 " + width + " " + height)
        .classed("svg-content-responsive", true);

    d3.tsv(fname, function(error, data) {
      if (error) throw error;
      // Coerce the data to numbers.
      data.forEach(function(d) {
        d.x = +d.x;
        d.y = +d.y;
      });

    // Compute the  domains.
    x.domain(d3.extent(data, function(d) { return d.x; })).nice();
    y.domain(d3.extent(data, function(d) { return d.y; })).nice();

    // Add a line
    var path = svg.append("path")
      .datum(data)
      .attr("class", "line")
      .attr("d", line);

    var totalLength = path.node().getTotalLength();

    path.attr("stroke-dasharray", totalLength + " " + totalLength)
      .attr("stroke-dashoffset", totalLength)
      .transition()
      .duration(10000)
        .ease("linear")
        .attr("stroke-dashoffset", 0);
    });

    svg.on("click", function(){
      var svg = d3.select(this);
      var path = svg.select("path");
      var totalLength = path.node().getTotalLength();

      path.transition()
        .duration(10)
        .ease("linear")
        .attr("stroke-dashoffset", totalLength)
       .transition()
        .duration(10000)
        .ease("linear")
        .attr("stroke-dashoffset", 0);

    });

    return svg;
}

var vis1 = animatedGPS("data_000349.tsv", "#vis-1");
var vis2 = animatedGPS("data_000378.tsv", "#vis-2");

var width = 300;
var height = 300;

var colors = [
"white",
"#8f57db",
"#d757db",
"#db5797"
];
    
var probsJSON =
{
"children": [
{"name": "Taskcode 1", "probability": 60},
{"name": "Taskcode 2", "probability": 25},
{"name": "Taskcode 3", "probability": 15}
]
};

var pack = d3.layout.pack()
.size([width, height])
.padding(10)
.value(function(d) { return d.probability; });
var packCalculations = pack.nodes(probsJSON);

var svg = d3.select("#vis-3").append("div").classed("svg-container-square", true)
.append("svg").attr("preserveAspectRatio", "xMinYMin meet")
.attr("viewBox", "0 0 " + width + " " + height).classed("svg-content-responsive", true)
.selectAll("g").data(packCalculations).enter();

var g = svg.append("g");
g.append("circle")
.attr("r", function(d){return d.r})
.style("fill", function(d, i){return colors[i%6];})
.on('mouseover',function() { d3.select(this).transition().duration(100).attr("opacity",0.5)})
.on('mouseout',function() { d3.select(this).transition().duration(100).attr("opacity",1)})
.attr("transform", function(d,i){return "translate(" + d.x + "," + d.y + ")"});
g.append("text")
.attr("x", -40).attr("y",5)
.attr("fill", "white")
.text(function(d){return d.name})
.attr("transform", function(d,i){return "translate(" + d.x + "," + d.y + ")"});

var svg2 = d3.select("#vis-4").append("div").classed("svg-container-short", true)
.append("svg").attr("preserveAspectRatio", "xMinYMin meet")
.attr("viewBox", "0 0 " + width + " " + width/5).classed("svg-content-responsive", true);

var rect = svg2.append("rect").attr("rx",10).attr("ry",10).style("fill","gray").attr("width",0.8*width).attr("height",width/5)
.attr("x",30)
.on('mouseover',function() { d3.select(this).transition().duration(100).attr("opacity",0.5)})
.on('mouseout',function() { d3.select(this).transition().duration(100).attr("opacity",1)});

var text = svg2.append("text").text("Taskcode not shown").attr("x",75).attr("y",35).attr("fill","white");

</script>
</body>

</html>
